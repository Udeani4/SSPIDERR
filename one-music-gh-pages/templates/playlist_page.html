{% include "header.html" %}
        <!-- ##### Hero Area Start ##### -->
        <section class="hero-area">
            <div class="hero-slides owl-carousel">
                <!-- Single Hero Slide -->
                <div class="single-hero-slide d-flex align-items-center justify-content-center">
                    <!-- Slide Img -->
                    <div class="slide-img bg-img" style="background-image: url('{{ playlist_image }}'); background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                background-color: black;"></div>
                    <!-- Slide Content -->
                    <div class="container" style="text-align: center">
                        <div class="row">
                            <div class="col-12">
                                <div class="hero-slides-content text-center" style="padding: 50px 0 0px 0;">

                                    <h2 style="font-size: 3rem; font-weight: bold; line-height: 1.2;" data-animation="fadeInUp" data-delay="300ms">{{ playlist['name'] }} <span>{{ playlist['name'] }}</span></h2>

                                    <h6 data-animation="fadeInUp" data-delay="100ms">{{ playlist['description'] }}</h6>

                                    <div class="single-page-stat">
                                        <h6 data-animation="fadeInUp" data-delay="100ms">STATS</h6>
                                        <div class="album-stats container">
                                            <div class="row justify-content-center text-center">

                                                <!-- Downloads -->
                                                <div class="col-4 col-sm-3">
                                                    <div class="stat-box">
                                                        <div class="stat-number">
                                                            <span class="counter">{{ avg_popularity }}</span>+
                                                        </div>
                                                        <div class="stat-label">Popularity</div>
                                                    </div>
                                                </div>

                                                <!-- Streams -->
                                                <div class="col-4 col-sm-3">
                                                    <div class="stat-box">
                                                        <div class="stat-number">
                                                            <span class="counter">{{ total_duration }}</span>hr+
                                                        </div>
                                                        <div class="stat-label">Total Duration</div>
                                                    </div>
                                                </div>

                                                <!-- Awards -->
                                                <div class="col-4 col-sm-3">
                                                    <div class="stat-box">
                                                        <div class="stat-number">
                                                            <span class="counter">5</span>
                                                        </div>
                                                        <div class="stat-label">Awards Won</div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>


                                    </div>

                                </div>
                                {% if current_user.is_authenticated: %}
                                    <div class="oneMusic-buttons-area mb-100">
                                        <a href="#" class="btn oneMusic-btn custom-btn m-2" onclick="openModal()">
                                            <i class="icon-cloud-computing" style="font-size: 20px;"></i>
                                            <span style="font-size: 14px; font-weight: 500;">Add to Playlist</span>
                                        </a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

        </section>

        <section>
            <!-- List of Album Songs -->


            <div class="col-12 col-lg-6" style="padding-top:100px">
                <div class="new-hits-area mb-100">
                    <div class="section-heading text-left mb-50 wow fadeInUp" data-wow-delay="50ms">
                        <p>{{ playlist['name'] }}</p>
                        <h2>Songs List</h2>
                    </div>

                    <!-- Single Top Item -->
                    {% for song in playlist_tracks: %}
                        <div class="single-new-item d-flex align-items-center justify-content-between wow fadeInUp" data-wow-delay="100ms">
                            <div class="first-part d-flex align-items-center">
                                <div class="thumbnail">
                                    <img src="{{ song['image'] }}" alt="">
                                </div>
                                <div class="content-">
                                    <a href="{{ url_for('song_page', song_id=song['id']) }}">
                                        <h6>{{ song['artist'] }}</h6>
                                        <p>{{ song['name'] }}</p>
                                    </a>

                                </div>
                            </div>
                            <!-- Audio and Icon side-by-side -->
                            <div style="display: flex; align-items: center; gap: 15px; flex-shrink: 0;">
                                <audio preload="auto" controls>
                                    <source src="{{ url_for('static', filename='audio/dummy-audio.mp3') }}">
                                </audio>
                                <a href = "#" style = "margin-left: auto;" class="open-btn" data-track-id="{{ song['id'] }}" onclick="openModal(this)">
                                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; margin-left: auto;">
                                        <i class="icon-cloud-computing" style="font-size: 30px; color: #000;"></i>
                                        <span style="font-size: 12px; color: #333; font-weight: 500;">Add to Playlist</span>
                                    </div>
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Modal -->
            <div class="modal" id="playlistModal">
              <div class="modal-content">
                <span class="close-btn" onclick="closeModal()">&times;</span>
                <h3>Choose a Playlist</h3>

                <!-- Playlist Items -->
                {% for playlist in playlist_list %}
                  <div class="playlist"
                       data-playlist-id="{{ playlist['id'] }}"
                       onclick="addToPlaylist('{{ playlist['id'] }}')">
                    <img src="{{ playlist['image'] }}" alt="{{ playlist['name'] }}">
                    <span class="playlist-name">{{ playlist['name'] }}</span>
                  </div>
                {% endfor %}

                <!-- Create Playlist Button -->
                <div class="create-btn-wrapper-popup">
                  <button class="open-btn-popup"
                          onclick="location.href='{{ url_for('create_playlist') }}'">
                    Create Playlist
                  </button>
                </div>
              </div>
            </div>
            <!-- Modal 2: Loading -->
            <div id="modal2" class="modal2">
              <div class="modal-content2">
                <span class="close-btn" onclick="closeModal2()">&times;</span>
                <h2 id="status-text">Loading Songs...</h2>
                <div class="loading-bar">
                  <div class="loader"></div>
                </div>
              </div>
            </div>


        </section>
{% include "footer.html" %}
<!--          ##### All Javascript Script #####-->
<!--    &lt;!&ndash; jQuery-2.2.4 js &ndash;&gt;-->
<!--    <script src="static/js/jquery/jquery-2.2.4.min.js"></script>-->
<!--    &lt;!&ndash; Popper js &ndash;&gt;-->
<!--    <script src="static/js/bootstrap/popper.min.js"></script>-->
<!--    &lt;!&ndash; Bootstrap js &ndash;&gt;-->
<!--    <script src="static/js/bootstrap/bootstrap.min.js"></script>-->
<!--    &lt;!&ndash; All Plugins js &ndash;&gt;-->
<!--    <script src="static/js/plugins/plugins.js"></script>-->
<!--    &lt;!&ndash; Active js &ndash;&gt;-->
<!--    <script src="static/js/active.js"></script>-->

    <script src="{{ url_for('static', filename='js/jquery/jquery-2.2.4.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/plugins.js') }}"></script>
    <script src="{{ url_for('static', filename='js/active.js') }}"></script>




    <!-- Modal Script -->
    <script>
        let selectedTrackId = null;

        /** ------------------------------
         *  MODAL CONTROL FUNCTIONS
         * ------------------------------ */
        function openModal(el) {
            // Store which song was clicked (for Add to Playlist)
            if (el && el.getAttribute('data-track-id')) {
                selectedTrackId = el.getAttribute('data-track-id');
            }

            document.getElementById("playlistModal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("playlistModal").style.display = "none";
        }

        function closeModal2() {
            document.getElementById("modal2").style.display = "none";
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modal1 = document.getElementById("playlistModal");
            const modal2 = document.getElementById("modal2");

            if (event.target === modal1) modal1.style.display = "none";
            if (event.target === modal2) modal2.style.display = "none";
        };

        /** ------------------------------
         *  ADD TO PLAYLIST FUNCTION
         * ------------------------------ */
        async function addToPlaylist(playlistId) {
            if (!selectedTrackId) {
                alert("No track selected.");
                return;
            }

            // Show loading modal
            startLoading();

            try {
                const response = await fetch('/add_to_playlist', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        playlist_id: playlistId,
                        track_id: selectedTrackId
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert(`✅ ${result.message}`);
                } else {
                    alert(`⚠️ ${result.error || "Something went wrong"}`);
                }
            } catch (error) {
                console.error(error);
                alert("⚠️ Unable to add song right now.");
            }

            stopLoading();
            closeModal();
        }

        /** ------------------------------
         *  LOADING / STATUS HANDLERS
         * ------------------------------ */
        function startLoading() {
            // Close playlist modal
            document.getElementById("playlistModal").style.display = "none";

            // Open loading modal
            const modal2 = document.getElementById("modal2");
            modal2.style.display = "block";

            // Animate loader
            const loader = document.querySelector(".loader");
            if (loader) loader.style.animation = "moveBackAndForth 1s infinite ease-in-out";

            // Update status text
            const statusText = document.getElementById("status-text");
            if (statusText) statusText.innerText = "Adding song to playlist...";
        }

        function stopLoading() {
            // Stop loader
            const loader = document.querySelector(".loader");
            if (loader) loader.style.animation = "none";

            // Reset cursor
            document.body.style.cursor = 'default';

            // Update status
            const statusText = document.getElementById("status-text");
            if (statusText) statusText.innerText = "Done!";
        }
    </script>


    </body>

</html>

